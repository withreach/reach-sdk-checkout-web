var rch=rch||{};rch.detail=rch.detail||{},rch.detail.regex=rch.detail.regex||{},rch.detail.regex.uuid=/^[A-F0-9]{8}-(?:[A-F0-9]{4}-){3}[A-F0-9]{12}$/i,rch.detail.regex.fingerprint=rch.detail.regex.uuid,rch.detail.regex.country=/^[A-Z]{2}$/,rch.detail.regex.currency=/^[A-Z]{3}$/,rch.detail.regex.iin=/^[0-9]{6}$/,rch.detail.regex.card=/^[0-9]{15,}$/,rch.detail.regex.cvv=/^[0-9]{3,4}$/,rch.detail.regex.year=/^[2-9][0-9]{3,}$/,rch.detail.regex.month=/^(0?[1-9]|1[0-2])$/,rch.detail.regex.paymentMethod=/^[A-Z]+$/,rch.detail.regex.contractIntent=/^[a-zA-Z]+$/,rch.detail.url=rch.detail.url||{},rch.detail.url.requirements="https://checkout-dev.gointerpay.net/v2.19/requirements",rch.detail.url.fingerprint="https://checkout-dev.gointerpay.net/v2.19/fingerprint",rch.detail.url.threeDSMethodNotificationURL="https://lister.gointerpay.net/~landon/3ds2/return_fingerprint.html",rch.detail.request=function(url,entity=null,contentType=null){return new Promise(function(resolve,reject){var xhr=new XMLHttpRequest;contentType&&xhr.setRequestHeader("Content-Type",contentType),xhr.onload=function(){200===xhr.status?resolve(xhr.responseText):reject(xhr.status,xhr.responseText)},xhr.onerror=function(e){reject(e)},xhr.open(entity?"POST":"GET",url),xhr.send(entity)})},rch.requirements=function(merchantId,params){return new Promise(function(resolve,reject){if(!merchantId||!rch.detail.regex.uuid.test(merchantId))throw Error("rch.requirements: Invalid MerchantId: "+merchantId);var url=rch.detail.url.requirements+"?MerchantId="+merchantId,checkAndAdd=function(name,re,required=!1){var val=params[name];if("string"==typeof val&&re.test(val))url+="&"+name+"="+val;else{if(void 0!==val)throw Error("rch.requirements: invalid "+name+": "+val);if(required)throw Error("rch.requirements: missing "+name)}};if(checkAndAdd("Currency",rch.detail.regex.currency,!0),checkAndAdd("DeviceFingerprint",rch.detail.regex.fingerprint,!0),checkAndAdd("Country",rch.detail.regex.country),checkAndAdd("IIN",rch.detail.regex.iin),checkAndAdd("PaymentMethod",rch.detail.regex.paymentMethod),checkAndAdd("ContractId",rch.detail.regex.uuid),checkAndAdd("ContractIntent",rch.detail.regex.contractIntent),"IIN"in params||(0+("PaymentMethod"in params)||!!(0+("ContractId"in params))))throw Error("rch.requirements: only one of IIN, PaymentMethod, or ContractId may be specified");rch.detail.request(url).then(function(result){console.log(result);var requirements=JSON.parse(result).Entity;requirements.threeDSMethodURL="https://pal-test.adyen.com/threeds2simulator/acs/startMethod.shtml",requirements.threeDSMethodURL?(console.log(params.DeviceFingerprint),console.log(requirements.threeDSMethodURL),console.log(rch.detail.url.threeDSMethodNotificationURL),window.threedsSDK.get3DSMethodStatus(params.DeviceFingerprint,requirements.threeDSMethodURL,rch.detail.url.threeDSMethodNotificationURL,document.body).then(function(resolveData){requirements.threeDSCompInd=resolveData.threeDSCompInd,resolve(requirements)})):resolve(requirements)})})},rch.challenge=function(url,windowSize,iframeContainer){return new Promise(function(resolve,reject){var iframeConfig={size:windowSize,container:iframeContainer},cReqData={challengeWindowSize:iframeConfig.size};window.threedsSDK.doReachChallenge(url,cReqData,iframeConfig,null).then(function(resolveData){resolve({transStatus:resolveData.transStatus})})})};